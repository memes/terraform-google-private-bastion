# Build forward-proxy image and store in Artifact Registry or
# Container Registry.
---
steps:
  - id: forward-proxy
    name: gcr.io/cloud-builders/docker
    args:
      - build
      - --file
      - Dockerfile
      - --build-arg
      - "COMMIT_SHA=${COMMIT_SHA}"
      - --build-arg
      - "TAG_NAME=${TAG_NAME}"
      - --tag
      - "${_CONTAINER_REPO}/forward-proxy:latest"
      - --tag
      - "${_CONTAINER_REPO}/forward-proxy:${TAG_NAME}"
      - .
    dir: containers/forward-proxy
images:
  - ${_CONTAINER_REPO}/forward-proxy:latest
  - ${_CONTAINER_REPO}/forward-proxy:${TAG_NAME}
substitutions:
  _CONTAINER_REPO: ''
